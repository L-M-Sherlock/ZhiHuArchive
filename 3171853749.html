<!DOCTYPE html>
<html lang="zh">
<head>
<title>å“ªäº› Rust åº“è®©ä½ ç›¸è§æ¨æ™šï¼Ÿ - @Thoughts Memo | ZhiHu Archive</title>
<meta charset="UTF-8">
<meta property="og:type" content="website">
<meta property="og:title" content="å“ªäº› Rust åº“è®©ä½ ç›¸è§æ¨æ™šï¼Ÿ - @Thoughts Memo | ZhiHu Archive">
<meta property="og:site_name" content="ZhiHu Archive for Thoughts Memo">
<meta property="og:description" itemprop="description" content="burn-rs ï¼Œä¸€ä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œæœªæ¥ FSRS èƒ½ä¸èƒ½åœ¨æ‰‹æœºç«¯è·‘ï¼Œå°±çœ‹å®ƒäº†ã€‚å¯¹æˆ‘è¿™ä¸ªç®—æ³•å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œè¿™ä¸ªåº“æ¯”è¾ƒèƒ½è§£å†³çš„ç—›ç‚¹åŒ…æ‹¬ï¼š ä¸ä¾èµ– torch/tensorflowï¼Œç¼–è¯‘å‡ºæ¥ä½“ç§¯å¾ˆå°ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯è¿›è¡Œå‚æ•°è®­ç»ƒï¼Œçº¯æœ¬åœ°åŒ–èƒ½è‡ªå·±å†™ forwardï¼Œè€Œä¸æ˜¯å‡ ä¸ªç½‘ç»œå±‚æ­ç§¯æœ¨ï¼Œæ¯”è¾ƒè‡ªç”±ï¼Œæ¯”å¦‚ä¸‹é¢å°±æ˜¯æˆ‘é‡å†™çš„ FSRSï¼š#[derive(Module, Debug)] pub struct Model<B: Backend> { pub w: Param<Tensor<B, 1>>, } impl<B: Backend<FloatElem = f32>> Modeâ€¦">
<meta property="og:url" content="https://www.zhihu.com/question/604594191/answer/3171853749">
<meta name="description" content="burn-rs ï¼Œä¸€ä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œæœªæ¥ FSRS èƒ½ä¸èƒ½åœ¨æ‰‹æœºç«¯è·‘ï¼Œå°±çœ‹å®ƒäº†ã€‚å¯¹æˆ‘è¿™ä¸ªç®—æ³•å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œè¿™ä¸ªåº“æ¯”è¾ƒèƒ½è§£å†³çš„ç—›ç‚¹åŒ…æ‹¬ï¼š ä¸ä¾èµ– torch/tensorflowï¼Œç¼–è¯‘å‡ºæ¥ä½“ç§¯å¾ˆå°ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯è¿›è¡Œå‚æ•°è®­ç»ƒï¼Œçº¯æœ¬åœ°åŒ–èƒ½è‡ªå·±å†™ forwardï¼Œè€Œä¸æ˜¯å‡ ä¸ªç½‘ç»œå±‚æ­ç§¯æœ¨ï¼Œæ¯”è¾ƒè‡ªç”±ï¼Œæ¯”å¦‚ä¸‹é¢å°±æ˜¯æˆ‘é‡å†™çš„ FSRSï¼š#[derive(Module, Debug)] pub struct Model<B: Backend> { pub w: Param<Tensor<B, 1>>, } impl<B: Backend<FloatElem = f32>> Modeâ€¦">
<meta data-pagefind-meta="title" content="å“ªäº› Rust åº“è®©ä½ ç›¸è§æ¨æ™šï¼Ÿ">
<link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/yue.css@0.4.0/yue.css">
<meta property="twitter:card" content="summary">
<meta name="twitter:title" content="å“ªäº› Rust åº“è®©ä½ ç›¸è§æ¨æ™šï¼Ÿ - @Thoughts Memo | ZhiHu Archive">
<meta name="twitter:description" content="burn-rs ï¼Œä¸€ä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œæœªæ¥ FSRS èƒ½ä¸èƒ½åœ¨æ‰‹æœºç«¯è·‘ï¼Œå°±çœ‹å®ƒäº†ã€‚å¯¹æˆ‘è¿™ä¸ªç®—æ³•å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œè¿™ä¸ªåº“æ¯”è¾ƒèƒ½è§£å†³çš„ç—›ç‚¹åŒ…æ‹¬ï¼š ä¸ä¾èµ– torch/tensorflowï¼Œç¼–è¯‘å‡ºæ¥ä½“ç§¯å¾ˆå°ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯è¿›è¡Œå‚æ•°è®­ç»ƒï¼Œçº¯æœ¬åœ°åŒ–èƒ½è‡ªå·±å†™ forwardï¼Œè€Œä¸æ˜¯å‡ ä¸ªç½‘ç»œå±‚æ­ç§¯æœ¨ï¼Œæ¯”è¾ƒè‡ªç”±ï¼Œæ¯”å¦‚ä¸‹é¢å°±æ˜¯æˆ‘é‡å†™çš„ FSRSï¼š#[derive(Module, Debug)] pub struct Model<B: Backend> { pub w: Param<Tensor<B, 1>>, } impl<B: Backend<FloatElem = f32>> Modeâ€¦">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
<meta name="google-site-verification" content="U7ZAFUgGNK60mmMqaRygg5vy-k8pwbPbDFXNjDCu7Xk" />
<link rel="alternate" type="application/rss+xml" title="ZhiHu Archive for Thoughts Memo" href="https://l-m-sherlock.github.io/ZhiHuArchive/feed.xml">
<script>
const redirect = false;
if (redirect) {
window.location.replace("https://www.zhihu.com/question/604594191/answer/3171853749");
}
</script>
<style>
img {
vertical-align: middle;
}
figure img {
width: 100%;
}
figure {
margin: 1.4em 0;
}
.author {
display: flex;
gap: 1em;
align-items: center;
}
#avatar {
width: 100px;
height: 100px;
}
.author > div {
flex: 1;
}
a {
color: #2563eb;
text-decoration: none;
border-bottom: 1px solid rgba(37, 99, 235, 0.3);
border-radius: 4px;
padding: 0 0.1em;
transition: color 0.2s ease, border-color 0.2s ease, background-color 0.2s ease;
}
a:hover,
a:focus-visible {
color: #1d4ed8;
border-bottom-color: rgba(29, 78, 216, 0.6);
background-color: rgba(37, 99, 235, 0.08);
}
a:focus-visible {
outline: none;
box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.25);
}
a[data-draft-type="link-card"] {
   display: block;
   border-bottom: none;
   padding: 0;
   background: none;
}
.references {
font-size: 0.85em;
}
.formula-display {
display: block;
text-align: center;
}
</style>
</head>
<body style="max-width: 1000px; margin: 0 auto; padding: 0 1em 0 1em;" class="yue">
<p data-pagefind-ignore><a href="./">â† è¿”å›ç›®å½•</a></p>
<hr>
<header>
<h1><a href="https://www.zhihu.com/question/604594191/answer/3171853749" target="_blank" rel="noopener noreferrer">å“ªäº› Rust åº“è®©ä½ ç›¸è§æ¨æ™šï¼Ÿ</a></h1>
<div class="author">
<img class="avatar" id="avatar" src="https://picx.zhimg.com/v2-d571786b77078321f5f6ef92f4967877_l.jpg?source=2c26e567" />
<div>
<h2 rel="author">
<a href="https://www.zhihu.com/people/4c592f496dc33822b560b382907ff1d0" target="_blank" rel="noopener noreferrer">@Thoughts Memo</a>
</h2>
<p>å­¦æ ¡â‰ æ•™è‚²â‰ æŠ€èƒ½ï¼›æ–‡å‡­æº¢ä»·=80%ä¿¡å·ä¼ é€’+20%äººåŠ›èµ„æœ¬</p>
</div>
</div>
<time datetime="2023-08-18T11:13:24">å‘è¡¨äº 2023å¹´08æœˆ18æ—¥</time>
<p rel="stats"style="color: #999; font-size: 0.9em;">121 ğŸ‘ / 17 ğŸ’¬</p>
</header>
<article data-pagefind-body>
<div style="margin: 0; padding: 0.5em 1em; border-left: 4px solid #999; font-size: 0.86em; background: #f9f9f9;">
<h2>é—®é¢˜æè¿°</h2>
<p>ç›¸ä¼¼é—®é¢˜ï¼š<a class="internal" href="https://www.zhihu.com/question/24590883" rel="noopener noreferrer" target="_blank">å“ªäº› Python åº“è®©ä½ ç›¸è§æ¨æ™šï¼Ÿ</a></p>
</div>
<hr>
<p data-pid="8YLYs8mb"><a class="wrap external" href="https://github.com/burn-rs/burn" rel="nofollow noreferrer noopener" target="_blank">burn-rs</a>ï¼Œä¸€ä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œæœªæ¥ FSRS èƒ½ä¸èƒ½åœ¨æ‰‹æœºç«¯è·‘ï¼Œå°±çœ‹å®ƒäº†ã€‚</p><p data-pid="Ks4a0PBb">å¯¹æˆ‘è¿™ä¸ªç®—æ³•å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œè¿™ä¸ªåº“æ¯”è¾ƒèƒ½è§£å†³çš„ç—›ç‚¹åŒ…æ‹¬ï¼š</p><ol><li data-pid="xmKxOpQV">ä¸ä¾èµ– torch/tensorflowï¼Œç¼–è¯‘å‡ºæ¥ä½“ç§¯å¾ˆå°ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯è¿›è¡Œå‚æ•°è®­ç»ƒï¼Œçº¯æœ¬åœ°åŒ–</li><li data-pid="MkoFXH1d">èƒ½è‡ªå·±å†™ forwardï¼Œè€Œä¸æ˜¯å‡ ä¸ªç½‘ç»œå±‚æ­ç§¯æœ¨ï¼Œæ¯”è¾ƒè‡ªç”±ï¼Œæ¯”å¦‚ä¸‹é¢å°±æ˜¯æˆ‘é‡å†™çš„ FSRSï¼š</li></ol><div class="highlight"><pre><code class="language-rust"><span class="cp">#[derive(Module, Debug)]</span><span class="w">
</span><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">Model</span><span class="o">&lt;</span><span class="n">B</span>: <span class="nc">Backend</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="n">w</span>: <span class="nc">Param</span><span class="o">&lt;</span><span class="n">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">B</span>: <span class="nc">Backend</span><span class="o">&lt;</span><span class="n">FloatElem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">f32</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">Model</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">new</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w"></span><span class="n">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w"></span><span class="n">w</span>: <span class="nc">Param</span>::<span class="n">from</span><span class="p">(</span><span class="n">Tensor</span>::<span class="n">from_floats</span><span class="p">([</span><span class="w">
</span><span class="w"></span><span class="mf">0.4</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6</span><span class="p">,</span><span class="w"> </span><span class="mf">2.4</span><span class="p">,</span><span class="w"> </span><span class="mf">5.8</span><span class="p">,</span><span class="w"> </span><span class="c1">// initial stability
</span><span class="c1"></span><span class="w"></span><span class="mf">4.93</span><span class="p">,</span><span class="w"> </span><span class="mf">0.94</span><span class="p">,</span><span class="w"> </span><span class="mf">0.86</span><span class="p">,</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="c1">// difficulty
</span><span class="c1"></span><span class="w"></span><span class="mf">1.49</span><span class="p">,</span><span class="w"> </span><span class="mf">0.14</span><span class="p">,</span><span class="w"> </span><span class="mf">0.94</span><span class="p">,</span><span class="w"> </span><span class="c1">// success
</span><span class="c1"></span><span class="w"></span><span class="mf">2.18</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05</span><span class="p">,</span><span class="w"> </span><span class="mf">0.34</span><span class="p">,</span><span class="w"> </span><span class="mf">1.26</span><span class="p">,</span><span class="w"> </span><span class="c1">// failure
</span><span class="c1"></span><span class="w"></span><span class="mf">0.29</span><span class="p">,</span><span class="w"> </span><span class="mf">2.61</span><span class="p">,</span><span class="w"> </span><span class="c1">// hard penalty, easy bonus
</span><span class="c1"></span><span class="w"></span><span class="p">])),</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">w</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w"></span><span class="bp">self</span><span class="p">.</span><span class="n">w</span><span class="p">.</span><span class="n">val</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">power_forgetting_curve</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">t</span>: <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">s</span>: <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">retrievability</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">).</span><span class="n">powf</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="n">retrievability</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">stability_after_success</span><span class="p">(</span><span class="w">
</span><span class="w"></span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">last_s</span>: <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">new_d</span>: <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">r</span>: <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">rating</span>: <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">batch_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rating</span><span class="p">.</span><span class="n">dims</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">hard_penalty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tensor</span>::<span class="n">ones</span><span class="p">([</span><span class="n">batch_size</span><span class="p">])</span><span class="w">
</span><span class="w"></span><span class="p">.</span><span class="n">mask_where</span><span class="p">(</span><span class="n">rating</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">equal_elem</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">w</span><span class="p">().</span><span class="n">slice</span><span class="p">([</span><span class="mi">15</span><span class="p">..</span><span class="mi">16</span><span class="p">]));</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">easy_bonus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tensor</span>::<span class="n">ones</span><span class="p">([</span><span class="n">batch_size</span><span class="p">])</span><span class="w">
</span><span class="w"></span><span class="p">.</span><span class="n">mask_where</span><span class="p">(</span><span class="n">rating</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">equal_elem</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">w</span><span class="p">().</span><span class="n">slice</span><span class="p">([</span><span class="mi">16</span><span class="p">..</span><span class="mi">17</span><span class="p">]));</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">new_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">last_s</span><span class="p">.</span><span class="n">clone</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">w</span><span class="p">().</span><span class="n">slice</span><span class="p">([</span><span class="mi">8</span><span class="p">..</span><span class="mi">9</span><span class="p">]).</span><span class="n">exp</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">new_d</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">11</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">w</span><span class="p">().</span><span class="n">slice</span><span class="p">([</span><span class="mi">9</span><span class="p">..</span><span class="mi">10</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">last_s</span><span class="p">.</span><span class="n">log</span><span class="p">()).</span><span class="n">exp</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="o">*</span><span class="w"> </span><span class="p">(((</span><span class="o">-</span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">w</span><span class="p">().</span><span class="n">slice</span><span class="p">([</span><span class="mi">10</span><span class="p">..</span><span class="mi">11</span><span class="p">])).</span><span class="n">exp</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="o">*</span><span class="w"> </span><span class="n">hard_penalty</span><span class="w">
</span><span class="w"></span><span class="o">*</span><span class="w"> </span><span class="n">easy_bonus</span><span class="w">
</span><span class="w"></span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="n">new_s</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">stability_after_failure</span><span class="p">(</span><span class="w">
</span><span class="w"></span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">last_s</span>: <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">new_d</span>: <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">r</span>: <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">new_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">w</span><span class="p">().</span><span class="n">slice</span><span class="p">([</span><span class="mi">11</span><span class="p">..</span><span class="mi">12</span><span class="p">])</span><span class="w">
</span><span class="w"></span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="p">.</span><span class="n">w</span><span class="p">().</span><span class="n">slice</span><span class="p">([</span><span class="mi">12</span><span class="p">..</span><span class="mi">13</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">new_d</span><span class="p">.</span><span class="n">log</span><span class="p">()).</span><span class="n">exp</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="bp">self</span><span class="p">.</span><span class="n">w</span><span class="p">().</span><span class="n">slice</span><span class="p">([</span><span class="mi">13</span><span class="p">..</span><span class="mi">14</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">last_s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">).</span><span class="n">log</span><span class="p">()).</span><span class="n">exp</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="o">-</span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">w</span><span class="p">().</span><span class="n">slice</span><span class="p">([</span><span class="mi">14</span><span class="p">..</span><span class="mi">15</span><span class="p">])).</span><span class="n">exp</span><span class="p">();</span><span class="w">
</span><span class="w"></span><span class="n">new_s</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">step</span><span class="p">(</span><span class="w">
</span><span class="w"></span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">i</span>: <span class="kt">usize</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">delta_t</span>: <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">rating</span>: <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">stability</span>: <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">difficulty</span>: <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="n">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">new_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">w</span><span class="p">().</span><span class="n">select</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">rating</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">int</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">new_d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">w</span><span class="p">().</span><span class="n">slice</span><span class="p">([</span><span class="mi">4</span><span class="p">..</span><span class="mi">5</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">w</span><span class="p">().</span><span class="n">slice</span><span class="p">([</span><span class="mi">5</span><span class="p">..</span><span class="mi">6</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">rating</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="n">new_s</span><span class="p">.</span><span class="n">clamp</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="mf">36500.0</span><span class="p">),</span><span class="w"> </span><span class="n">new_d</span><span class="p">.</span><span class="n">clamp</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">10.0</span><span class="p">))</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">power_forgetting_curve</span><span class="p">(</span><span class="n">delta_t</span><span class="p">,</span><span class="w"> </span><span class="n">stability</span><span class="p">.</span><span class="n">clone</span><span class="p">());</span><span class="w">
</span><span class="w"></span><span class="c1">// dbg!(&amp;r);
</span><span class="c1"></span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">new_d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">difficulty</span><span class="p">.</span><span class="n">clone</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">w</span><span class="p">().</span><span class="n">slice</span><span class="p">([</span><span class="mi">6</span><span class="p">..</span><span class="mi">7</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">rating</span><span class="p">.</span><span class="n">clone</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">new_d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_d</span><span class="p">.</span><span class="n">clamp</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">10.0</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="c1">// dbg!(&amp;new_d);
</span><span class="c1"></span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">s_recall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">stability_after_success</span><span class="p">(</span><span class="w">
</span><span class="w"></span><span class="n">stability</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w">
</span><span class="w"></span><span class="n">new_d</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w">
</span><span class="w"></span><span class="n">r</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w">
</span><span class="w"></span><span class="n">rating</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w">
</span><span class="w"></span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">s_forget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">stability_after_failure</span><span class="p">(</span><span class="n">stability</span><span class="p">,</span><span class="w"> </span><span class="n">new_d</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"> </span><span class="n">r</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">new_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s_recall</span><span class="p">.</span><span class="n">mask_where</span><span class="p">(</span><span class="n">rating</span><span class="p">.</span><span class="n">equal_elem</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">s_forget</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="n">new_s</span><span class="p">.</span><span class="n">clamp</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="mf">36500.0</span><span class="p">),</span><span class="w"> </span><span class="n">new_d</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">forward</span><span class="p">(</span><span class="w">
</span><span class="w"></span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">delta_ts</span>: <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="n">ratings</span>: <span class="nc">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">Float</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="n">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Tensor</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="p">[</span><span class="n">seq_len</span><span class="p">,</span><span class="w"> </span><span class="n">batch_size</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delta_ts</span><span class="p">.</span><span class="n">dims</span><span class="p">();</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">stability</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tensor</span>::<span class="n">zeros</span><span class="p">([</span><span class="n">batch_size</span><span class="p">]);</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">difficulty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tensor</span>::<span class="n">zeros</span><span class="p">([</span><span class="n">batch_size</span><span class="p">]);</span><span class="w">
</span><span class="w"></span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="p">..</span><span class="n">seq_len</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">delta_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delta_ts</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">slice</span><span class="p">([</span><span class="n">i</span><span class="p">..</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]).</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">rating</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ratings</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">slice</span><span class="p">([</span><span class="n">i</span><span class="p">..</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]).</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="c1">// dbg!(&amp;delta_t);
</span><span class="c1"></span><span class="w"></span><span class="c1">// dbg!(&amp;rating);
</span><span class="c1"></span><span class="w"></span><span class="p">(</span><span class="n">stability</span><span class="p">,</span><span class="w"> </span><span class="n">difficulty</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">step</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">delta_t</span><span class="p">,</span><span class="w"> </span><span class="n">rating</span><span class="p">,</span><span class="w"> </span><span class="n">stability</span><span class="p">,</span><span class="w"> </span><span class="n">difficulty</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="c1">// dbg!(&amp;stability);
</span><span class="c1"></span><span class="w"></span><span class="c1">// dbg!(&amp;difficulty);
</span><span class="c1"></span><span class="w"></span><span class="c1">// dbg!()
</span><span class="c1"></span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="n">stability</span><span class="p">,</span><span class="w"> </span><span class="n">difficulty</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p data-pid="yxkvtADg">ä¸è¿‡è¿™ä¸ªåº“è¿˜æ˜¯æœ‰å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li data-pid="7ZC5phNK">è®­ç»ƒè¿‡ç¨‹æœ‰ç‚¹è¿‡åº¦å°è£…äº†ï¼Œæƒ³è¦è‡ªå·±å†™ä¸ªè¿­ä»£çš„ loop å¾ˆéš¾</li><li data-pid="pwwgbOgW">ä¸æ”¯æŒè®­ç»ƒè¿‡ç¨‹ä¸­ä¿®æ”¹å‚æ•°ï¼Œæˆ‘æƒ³åšä¸ªå‚æ•°å‰ªè£ï¼Œç›®å‰è¿˜æ²¡æ‰¾åˆ°æ–¹æ³•</li></ol><p data-pid="U1fml772">åæ­£è¾¹å†™è¾¹è¸©å‘ï¼Œè¾¹ç»™ç¤¾åŒºæ issueï¼Œå¸Œæœ›ä»Šå¹´èƒ½æŠŠè¿™ä¸ªé¡¹ç›®å†™å®Œå§ã€‚</p><a class="wrap external" data-draft-node="block" data-draft-type="link-card" href="https://github.com/open-spaced-repetition/fsrs-optimizer-burn" rel="nofollow noreferrer noopener" target="_blank">open-spaced-repetition/fsrs-optimizer-burn: Rust-based Optimizer for FSRS (github.com)</a><p data-pid="fbxTf3tH">ä¹Ÿæ¬¢è¿ Rust å¤§ä½¬å‰æ¥åŠ©é˜µï¼</p><p data-pid="fye122R3">æ›´å¤šæœ‰å…³ FSRS çš„ä»‹ç»ï¼Œè¯·è§ï¼š</p><a class="internal" data-draft-node="block" data-draft-type="link-card" data-image="https://pic2.zhimg.com/v2-337e676d732039a25471c1057c54bfa3_180x120.jpg" data-image-height="1480" data-image-width="2700" href="./577383961.html" rel="noopener noreferrer" target="_blank">å¶å³»å³£ï¼šKDD'22 | å¢¨å¢¨èƒŒå•è¯ï¼šåŸºäºæ—¶åºæ¨¡å‹ä¸æœ€ä¼˜æ§åˆ¶çš„è®°å¿†ç®—æ³• [AI+æ•™è‚²]</a><a class="internal" data-draft-node="block" data-draft-type="link-card" data-image="https://pic1.zhimg.com/v2-9c14ae073ac7ff2f3d208d31b0ed10b2_180x120.jpg" data-image-height="1304" data-image-width="2638" href="./649655080.html" rel="noopener noreferrer" target="_blank">å¶å³»å³£ï¼šè§£é‡Š FSRSï¼ˆä¸Šç¯‡ï¼‰ï¼šç®—æ³•æè¿°ä¸è¿ä½œåŸç†</a><a class="internal" data-draft-node="block" data-draft-type="link-card" data-image="https://pic4.zhimg.com/v2-e9f56ba072166b28b7c371e246a79fc5_180x120.jpg" data-image-height="1304" data-image-width="2638" href="./649701172.html" rel="noopener noreferrer" target="_blank">å¶å³»å³£ï¼šè§£é‡Š FSRSï¼ˆä¸‹ç¯‡ï¼‰ï¼šå‡†ç¡®åº¦</a><p></p>

<hr>
<p data-pagefind-ignore><a href="./">â† è¿”å›ç›®å½•</a></p>
</article>
<footer>
<p style="color: #999; font-size: 0.85em; text-align: center; margin-top: 2em;">
æœ¬é¡µé¢ç”± <a href="https://github.com/L-M-Sherlock/ZhiHuArchive" target="_blank" rel="noopener noreferrer">ZhiHuArchive</a> æ¸²æŸ“ï¼Œæ¨¡æ¿å‚è€ƒ <a href="https://github.com/frostming/fxzhihu" target="_blank" rel="noopener noreferrer">FxZhihu</a>ã€‚
</p>
</footer>
<script src="https://giscus.app/client.js"
data-repo="L-M-Sherlock/ZhiHuArchive"
data-repo-id="MDEwOlJlcG9zaXRvcnkzNDk5NDE0MzM="
data-category="Announcements"
data-category-id="DIC_kwDOFNuuuc4Ck92x"
data-mapping="title"
data-strict="0"
data-reactions-enabled="1"
data-emit-metadata="0"
data-input-position="top"
data-theme="preferred_color_scheme"
data-lang="zh-CN"
data-loading="lazy"
crossorigin="anonymous"
async>
</script>
</body>
</html>